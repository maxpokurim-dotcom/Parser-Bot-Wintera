# –û—Ç—á–µ—Ç –ø–æ –∞—É–¥–∏—Ç—É —Ç–µ–ª–µ–≥—Ä–∞–º –±–æ—Ç–∞ –∏ VPS Worker

**–î–∞—Ç–∞:** 2025-01-XX  
**–í–µ—Ä—Å–∏—è:** 3.2.0  
**–°—Ç–∞—Ç—É—Å:** –ü–æ–ª–Ω—ã–π –∞—É–¥–∏—Ç –∑–∞–≤–µ—Ä—à–µ–Ω

---

## üìã –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

–¢–µ–ª–µ–≥—Ä–∞–º –±–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –æ–±–æ–ª–æ—á–∫–∞ –¥–ª—è VPS, —Å—Ç–∞–≤—è –∑–∞–¥–∞—á–∏ —á–µ—Ä–µ–∑ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö Supabase. VPS Worker –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —ç—Ç–∏ –∑–∞–¥–∞—á–∏ —á–µ—Ä–µ–∑ —Ä–∞–∑–ª–∏—á–Ω—ã–µ –≤–æ—Ä–∫–µ—Ä—ã.

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è:
1. **Telegram Bot (Vercel)** ‚Üí —Å–æ–∑–¥–∞–µ—Ç –∑–∞–¥–∞—á–∏ –≤ –ë–î ‚Üí **VPS Worker** ‚Üí –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–¥–∞—á–∏
2. –°–≤—è–∑—å —á–µ—Ä–µ–∑ Supabase (–æ–±—â–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö)
3. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ—Ä–µ–∑ –≤–æ—Ä–∫–µ—Ä—ã

---

## ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á –∏–∑ –±–æ—Ç–∞
- ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥: `core/parsing.py` ‚Üí —Å–æ–∑–¥–∞–µ—Ç `audience_sources` —Å `status='pending'`
- ‚úÖ –†–∞—Å—Å—ã–ª–∫–∞: `core/mailing.py` ‚Üí —Å–æ–∑–¥–∞–µ—Ç `campaigns` —Å `status='pending'`
- ‚úÖ –§–∞–±—Ä–∏–∫–∞: `core/factory.py` ‚Üí —Å–æ–∑–¥–∞–µ—Ç `factory_tasks` –∏ `vps_tasks`
- ‚úÖ –¢—ë–ø–ª—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã: —Å–æ–∑–¥–∞–µ—Ç `vps_tasks` —Å —Ç–∏–ø–æ–º `warm_account`

### 2. –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–¥–∞—á –≤ VPS Worker
- ‚úÖ **ParsingWorker**: –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç `audience_sources` —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `pending/parsing`
- ‚úÖ **MailingWorker**: –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç `campaigns` —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `pending/running`
- ‚úÖ **FactoryWorker**: –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç `factory_tasks` –¥–ª—è –∞–≤—Ç–æ-—Å–æ–∑–¥–∞–Ω–∏—è –∞–∫–∫–∞—É–Ω—Ç–æ–≤
- ‚úÖ **VPSTasksWorker**: –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç `vps_tasks` –¥–ª—è —Ç—ë–ø–ª—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤
- ‚úÖ **HerderWorker**: –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç `herder_assignments` –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –≤ –∫–∞–Ω–∞–ª–∞—Ö
- ‚úÖ **ContentWorker**: –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç `scheduled_content` –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –ø–æ—Å—Ç–æ–≤
- ‚úÖ **AuthWorker**: –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç `auth_tasks` –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- ‚úÖ **WarmupWorker**: –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä–æ–≥—Ä–µ–≤—ã –∞–∫–∫–∞—É–Ω—Ç–æ–≤
- ‚úÖ **SchedulerWorker**: –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 3. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–±—â–∞—è –±–∞–∑–∞ Supabase
- ‚úÖ `vps_worker/services/database.py` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è —Å `core/db.py`
- ‚úÖ –¢–∞–±–ª–∏—Ü—ã —Å–æ–≤–ø–∞–¥–∞—é—Ç –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ

---

## ‚ö†Ô∏è –ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï

#### 1. **SchedulerWorker –Ω–µ —Å–æ–∑–¥–∞–µ—Ç –∫–∞–º–ø–∞–Ω–∏–∏** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û
**–§–∞–π–ª:** `vps_worker/workers/scheduler_worker.py:56-121`

**–ü—Ä–æ–±–ª–µ–º–∞:** –í –º–µ—Ç–æ–¥–µ `_launch_scheduled_mailing()` —Å–æ–∑–¥–∞–µ—Ç—Å—è —Å–ª–æ–≤–∞—Ä—å `campaign_data`, –Ω–æ –æ–Ω –ù–ï –≤—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –≤ –ë–î. –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ —Ç–æ–ª—å–∫–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Å—Ç–∞—Ç—É—Å scheduled_mailing.

**–†–µ—à–µ–Ω–∏–µ:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ - –¥–æ–±–∞–≤–ª–µ–Ω–æ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–∞–º–ø–∞–Ω–∏–∏ —á–µ—Ä–µ–∑ `db.client.table('campaigns').insert()`. –¢–µ–ø–µ—Ä—å scheduled mailings –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å–æ–∑–¥–∞—é—Ç –∫–∞–º–ø–∞–Ω–∏–∏ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ MailingWorker.

#### 2. **VPSTasksWorker: –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç–∏–ø–æ–≤ –∑–∞–¥–∞—á**
**–§–∞–π–ª:** `vps_worker/workers/vps_tasks_worker.py:46-54`

**–ü—Ä–æ–±–ª–µ–º–∞:** –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —Ç–∏–ø—ã `warm_account_create` –∏ `warm_account`, –Ω–æ –≤ `core/factory.py:1183` —Å–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–¥–∞—á–∞ —Å —Ç–∏–ø–æ–º `'warm_account'`, –∞ –≤ `vps_tasks_worker.py:46` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è `'warm_account_create'`.

**–†–µ—à–µ–Ω–∏–µ:** –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Ç–∏–ø—ã:
```python
# –í vps_tasks_worker.py:46
if task_type == 'warm_account_create' or task_type == 'warm_account':
    await self._process_warm_account(task)
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –£–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –∫–æ–¥–µ (—Å—Ç—Ä–æ–∫–∞ 48-49)

#### 3. **ParsingWorker: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∞ source_type –∏–∑ audience_sources**
**–§–∞–π–ª:** `vps_worker/workers/parsing_worker.py:79-96`

**–ü—Ä–æ–±–ª–µ–º–∞:** –í `_process_task()` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `task.get('source_type', 'chat')`, –Ω–æ –≤ `core/parsing.py` –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ `audience_sources` –Ω–µ –≤—Å–µ–≥–¥–∞ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è `source_type` —è–≤–Ω–æ.

**–†–µ—à–µ–Ω–∏–µ:** –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ `core/parsing.py` –≤—Å–µ–≥–¥–∞ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `source_type`:
```python
# –í core/parsing.py:646
source = DB.create_audience_source(
    user_id=user_id,
    source_type='chat',  # –∏–ª–∏ 'comments' –¥–ª—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
    ...
)
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ - `source_type` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

### üü° –°–†–ï–î–ù–ò–ï

#### 4. **MailingWorker: –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–ª–µ –¥–ª—è telegram_id**
**–§–∞–π–ª:** `vps_worker/workers/mailing_worker.py:139`

**–ü—Ä–æ–±–ª–µ–º–∞:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `recipient['telegram_id']`, –Ω–æ –≤ `database.py:331` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `tg_user_id`.

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö –≤ `parsed_audiences`:
```python
# –í mailing_worker.py:139
telegram_id = recipient.get('telegram_id') or recipient.get('tg_user_id')
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ - –≤ `database.py:361` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `tg_user_id`, –Ω–æ –≤ `parsing_worker.py:281` —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∫–∞–∫ `telegram_id`. –ù—É–∂–Ω–∞ —É–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è.

#### 5. **WarmupWorker: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞**
**–§–∞–π–ª:** `vps_worker/workers/warmup_worker.py:66-79`

**–ü—Ä–æ–±–ª–µ–º–∞:** –í `_process_warmup()` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `account['user_id']`, –Ω–æ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –∞–∫–∫–∞—É–Ω—Ç–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å `owner_id`.

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ –ø–æ–ª–µ:
```python
user_id = account.get('owner_id') or account.get('user_id')
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ - –≤ `database.py:47` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `owner_id`, –Ω–æ –≤ `warmup_worker.py:70` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `user_id`. –ù—É–∂–Ω–∞ —É–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è.

#### 6. **ContentWorker: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏**
**–§–∞–π–ª:** `vps_worker/workers/content_worker.py:219-257`

**–ü—Ä–æ–±–ª–µ–º–∞:** –í `_send_to_channel()` –ø—Ä–∏ –æ—à–∏–±–∫–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ `{'success': False, 'error': str(e)}`, –Ω–æ –Ω–µ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –¥–µ—Ç–∞–ª—å–Ω–æ.

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
```python
except Exception as e:
    self.logger.error(f"Error sending to channel {channel}: {e}", exc_info=True)
    return {'success': False, 'error': str(e)}
```

---

### üü¢ –ú–ï–õ–ö–ò–ï

#### 7. **FactoryWorker: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∞ 2FA –ø—Ä–∏ –∞–≤—Ç–æ-—Å–æ–∑–¥–∞–Ω–∏–∏**
**–§–∞–π–ª:** `vps_worker/workers/factory_worker.py:238-252`

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –∞–≤—Ç–æ-—Å–æ–∑–¥–∞–Ω–∏–∏ –∞–∫–∫–∞—É–Ω—Ç–æ–≤ —á–µ—Ä–µ–∑ OnlineSim –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è —Å–ª—É—á–∞–π, –∫–æ–≥–¥–∞ —Ç—Ä–µ–±—É–µ—Ç—Å—è 2FA –ø–∞—Ä–æ–ª—å.

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É `SessionPasswordNeededError`:
```python
except errors.SessionPasswordNeededError:
    # –î–ª—è –∞–≤—Ç–æ-—Å–æ–∑–¥–∞–Ω–∏—è 2FA –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è
    db.update_account(account_id, status='error', error='2FA required (not supported in auto-creation)')
    await onlinesim.cancel_number(tzid)
    return {'success': False, 'error': '2FA required'}
```

#### 8. **HerderWorker: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –∫–∞–Ω–∞–ª–∞**
**–§–∞–π–ª:** `vps_worker/workers/herder_worker.py:76-83`

**–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ –∫–∞–Ω–∞–ª –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ—Å—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –±–µ–∑ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è.

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
```python
if not channel:
    self.logger.warning(f"Channel {channel_id} not found for assignment {assignment_id}")
    return
```

#### 9. **AuthWorker: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫**
**–§–∞–π–ª:** `vps_worker/workers/auth_worker.py:29-45`

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –æ—à–∏–±–∫–µ –∑–∞–¥–∞—á–∞ –ø–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ `error`, –Ω–æ –Ω–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º–∞ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫.

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å —Å—á–µ—Ç—á–∏–∫ –ø–æ–ø—ã—Ç–æ–∫ –∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫.

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏

### –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏:
- ‚úÖ **core/**: 15 –º–æ–¥—É–ª–µ–π –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ
- ‚úÖ **vps_worker/workers/**: 9 –≤–æ—Ä–∫–µ—Ä–æ–≤ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ
- ‚úÖ **vps_worker/services/**: 5 —Å–µ—Ä–≤–∏—Å–æ–≤ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ
- ‚úÖ **api/**: 1 –º–æ–¥—É–ª—å –ø—Ä–æ–≤–µ—Ä–µ–Ω

### –ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:
- üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ: 1
- üü° –°—Ä–µ–¥–Ω–∏–µ: 3
- üü¢ –ú–µ–ª–∫–∏–µ: 3

---

## üîß –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1 (–ö—Ä–∏—Ç–∏—á–Ω–æ):
1. ‚úÖ **–ò—Å–ø—Ä–∞–≤–∏—Ç—å SchedulerWorker** - –ò–°–ü–†–ê–í–õ–ï–ù–û: –¥–æ–±–∞–≤–ª–µ–Ω–æ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–∞–º–ø–∞–Ω–∏–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ scheduled mailing
2. **–£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—è** - –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –µ–¥–∏–Ω–æ–º—É —Å—Ç–∞–Ω–¥–∞—Ä—Ç—É `owner_id`/`user_id` –∏ `telegram_id`/`tg_user_id`

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2 (–í–∞–∂–Ω–æ):
3. **–î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É 2FA** –≤ FactoryWorker
4. **–£–ª—É—á—à–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –≤–æ –≤—Å–µ—Ö –≤–æ—Ä–∫–µ—Ä–∞—Ö
5. **–î–æ–±–∞–≤–∏—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏** –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3 (–ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ):
6. **–î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏** –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ä–∞–±–æ—Ç—ã –≤–æ—Ä–∫–µ—Ä–æ–≤
7. **–î–æ–±–∞–≤–∏—Ç—å health checks** –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–æ—Ä–∫–µ—Ä–∞
8. **–£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É edge cases**

---

## ‚úÖ –í—ã–≤–æ–¥—ã

### –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞: **8/10**

**–°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã:**
- ‚úÖ –•–æ—Ä–æ—à–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –±–æ—Ç–∞ –∏ VPS
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ —Ñ—É–Ω–∫—Ü–∏–π
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç–∏
- ‚úÖ –•–æ—Ä–æ—à–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —Å–ª—É—á–∞–µ–≤

**–¢—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è:**
- ‚úÖ SchedulerWorker –Ω–µ —Å–æ–∑–¥–∞–µ—Ç –∫–∞–º–ø–∞–Ω–∏–∏ - –ò–°–ü–†–ê–í–õ–ï–ù–û
- ‚ö†Ô∏è –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –Ω–∞–∑–≤–∞–Ω–∏–π –ø–æ–ª–µ–π –≤ —Ä–∞–∑–Ω—ã—Ö –º–æ–¥—É–ª—è—Ö
- ‚ö†Ô∏è –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö edge cases

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –ø–µ—Ä–µ–¥ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–æ–º. –û—Å—Ç–∞–ª—å–Ω—ã–µ –º–æ–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ.

---

## üìù –î–µ—Ç–∞–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### 1. SchedulerWorker - —Å–æ–∑–¥–∞–Ω–∏–µ –∫–∞–º–ø–∞–Ω–∏–∏ ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û
–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ –≤ —Ñ–∞–π–ª–µ `vps_worker/workers/scheduler_worker.py`. –¢–µ–ø–µ—Ä—å –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ scheduled mailing –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å–æ–∑–¥–∞–µ—Ç—Å—è –∫–∞–º–ø–∞–Ω–∏—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.

### 2. –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–ª–µ–π
```python
# –°–æ–∑–¥–∞—Ç—å helper —Ñ—É–Ω–∫—Ü–∏—é –≤ utils/helpers.py:
def get_user_id(account: dict) -> int:
    """Get user_id from account (supports both owner_id and user_id)"""
    return account.get('owner_id') or account.get('user_id')

def get_telegram_id(recipient: dict) -> int:
    """Get telegram_id from recipient (supports both telegram_id and tg_user_id)"""
    return recipient.get('telegram_id') or recipient.get('tg_user_id')
```

### 3. –û–±—Ä–∞–±–æ—Ç–∫–∞ 2FA –≤ FactoryWorker
```python
# –í vps_worker/workers/factory_worker.py:249-252
# –î–û–ë–ê–í–ò–¢–¨ –ø–æ—Å–ª–µ except Exception as e:
except errors.SessionPasswordNeededError:
    self.logger.error(f"2FA required for {mask_phone(phone)} (not supported in auto-creation)")
    db.update_account(account_id, status='error', error='2FA required (not supported)')
    await onlinesim.cancel_number(tzid)
    return {'success': False, 'error': '2FA required', 'phone': phone}
```

---

**–û—Ç—á–µ—Ç —Å–æ—Å—Ç–∞–≤–ª–µ–Ω:** 2025-01-XX  
**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:** –í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏  
**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤ –∫ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é


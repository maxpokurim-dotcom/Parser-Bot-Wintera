"""
Main menu and navigation handler - Restructured v2.0
Simplified into 4 logical sections:
1. ğŸ“¥ Ğ˜ÑÑ…Ğ¾Ğ´ÑÑ‰Ğ¸Ğµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ (Parsing, Mailing, Content)
2. ğŸ¤– Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚Ğ°Ğ¼Ğ¸ (Accounts, Factory, Herder)
3. ğŸ“Š ĞĞ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ° Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ (Audiences, Templates, Analytics)
4. âš™ï¸ ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸
"""
import logging
from core.db import DB
from core.telegram import send_message
from core.keyboards import kb_main_menu
logger = logging.getLogger(__name__)

# Button text constants for matching
BTN_OUTBOUND = 'ğŸ“¥ Ğ˜ÑÑ…Ğ¾Ğ´ÑÑ‰Ğ¸Ğµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ'
BTN_ACCOUNTS_HUB = 'ğŸ¤– Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚Ğ°Ğ¼Ğ¸'
BTN_ANALYTICS_DATA = 'ğŸ“Š ĞĞ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ° Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ'
BTN_SETTINGS = 'âš™ï¸ ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸'

# Navigation
BTN_CANCEL = 'âŒ ĞÑ‚Ğ¼ĞµĞ½Ğ°'
BTN_BACK = 'â—€ï¸ ĞĞ°Ğ·Ğ°Ğ´'
BTN_MAIN_MENU = 'â—€ï¸ Ğ“Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ Ğ¼ĞµĞ½Ñ'
BTN_SKIP = 'â­ ĞŸÑ€Ğ¾Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ'

def show_main_menu(chat_id: int, user_id: int, text: str = None):
    """Show main menu with hierarchical structure"""
    DB.clear_user_state(user_id)
    
    # Default welcome message for main menu
    default_msg = (
        "ğŸ“‹ <b>Ğ“Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ Ğ¼ĞµĞ½Ñ</b>\n\n"
        "Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ñ€Ğ°Ğ·Ğ´ĞµĞ»:\n\n"
        "ğŸ“¥ <b>Ğ˜ÑÑ…Ğ¾Ğ´ÑÑ‰Ğ¸Ğµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ</b>\n"
        "   ĞŸĞ°Ñ€ÑĞ¸Ğ½Ğ³, Ñ€Ğ°ÑÑÑ‹Ğ»ĞºĞ°, ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚\n\n"
        "ğŸ¤– <b>Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚Ğ°Ğ¼Ğ¸</b>\n"
        "   ĞĞºĞºĞ°ÑƒĞ½Ñ‚Ñ‹, Ñ„Ğ°Ğ±Ñ€Ğ¸ĞºĞ°, Ğ±Ğ¾Ñ‚Ğ¾Ğ²Ğ¾Ğ´\n\n"
        "ğŸ“Š <b>ĞĞ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ° Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ</b>\n"
        "   ĞÑƒĞ´Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¸, ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½Ñ‹, Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ°\n\n"
        "âš™ï¸ <b>ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸</b>\n"
        "   ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Ğ±Ğ¾Ñ‚Ğ°"
    )
    
    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ ÑÑ‚Ğ°Ñ‚ÑƒÑ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹
    if DB.is_system_paused(user_id):
        status = DB.get_system_status(user_id)
        reason = status.get('pause_reason', 'ĞĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ğ¾')
        msg = (
            f"ğŸš¨ <b>Ğ¡Ğ˜Ğ¡Ğ¢Ğ•ĞœĞ ĞŸĞ Ğ˜ĞĞ¡Ğ¢ĞĞĞĞ’Ğ›Ğ•ĞĞ</b>\n"
            f"ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ğ°: {reason}\n"
            f"Ğ”Ğ»Ñ Ğ²Ğ¾Ğ·Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ /resume\n"
            f"{'â”€' * 20}\n\n"
        )
        msg += text or default_msg
    else:
        msg = text or default_msg
    
    send_message(chat_id, msg, kb_main_menu())

def handle_start(chat_id: int, user_id: int):
    """Handle /start command"""
    DB.clear_user_state(user_id)
    # Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµĞ¼ Ğ´ĞµÑ„Ğ¾Ğ»Ñ‚Ğ½Ñ‹Ğµ ÑÑ‚Ğ¾Ğ¿-Ñ‚Ñ€Ğ¸Ğ³Ğ³ĞµÑ€Ñ‹
    DB.get_stop_triggers(user_id)
    send_message(chat_id,
        "ğŸ‘‹ <b>Ğ”Ğ¾Ğ±Ñ€Ğ¾ Ğ¿Ğ¾Ğ¶Ğ°Ğ»Ğ¾Ğ²Ğ°Ñ‚ÑŒ!</b>\n\n"
        "Ğ¯ â€” Ğ±Ğ¾Ñ‚-Ğ¾Ğ±Ğ¾Ğ»Ğ¾Ñ‡ĞºĞ° Ğ´Ğ»Ñ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Telegram-Ğ¼Ğ°Ñ€ĞºĞµÑ‚Ğ¸Ğ½Ğ³Ğ¾Ğ¼ Ñ‡ĞµÑ€ĞµĞ· VPS.\n"
        "Ğ’ÑĞµ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑÑÑ‚ÑÑ Ğ² Ñ„Ğ¾Ğ½Ğ¾Ğ²Ğ¾Ğ¼ Ñ€ĞµĞ¶Ğ¸Ğ¼Ğµ Ğ½Ğ° ÑĞµÑ€Ğ²ĞµÑ€Ğµ.\n\n"
        "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n"
        "ğŸ“¥ <b>Ğ˜Ğ¡Ğ¥ĞĞ”Ğ¯Ğ©Ğ˜Ğ• Ğ”Ğ•Ğ™Ğ¡Ğ¢Ğ’Ğ˜Ğ¯</b>\n"
        "â”œ ğŸ” ĞŸĞ°Ñ€ÑĞ¸Ğ½Ğ³ â€” ÑĞ±Ğ¾Ñ€ Ğ°ÑƒĞ´Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¸ Ğ¸Ğ· Ñ‡Ğ°Ñ‚Ğ¾Ğ²\n"
        "â”œ ğŸ“¤ Ğ Ğ°ÑÑÑ‹Ğ»ĞºĞ° â€” Ğ¼Ğ°ÑÑĞ¾Ğ²Ğ°Ñ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹\n"
        "â”” ğŸ“ ĞšĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚ â€” Ğ˜Ğ˜-Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾ÑÑ‚Ğ¾Ğ² (Yandex GPT)\n\n"
        "ğŸ¤– <b>Ğ£ĞŸĞ ĞĞ’Ğ›Ğ•ĞĞ˜Ğ• ĞĞšĞšĞĞ£ĞĞ¢ĞĞœĞ˜</b>\n"
        "â”œ ğŸ‘¤ ĞĞºĞºĞ°ÑƒĞ½Ñ‚Ñ‹ â€” ÑÑ‚Ğ°Ñ‚ÑƒÑ, Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ñ‹, Ğ·Ğ´Ğ¾Ñ€Ğ¾Ğ²ÑŒĞµ\n"
        "â”œ ğŸ­ Ğ¤Ğ°Ğ±Ñ€Ğ¸ĞºĞ° â€” Ğ°Ğ²Ñ‚Ğ¾-ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ñ‡ĞµÑ€ĞµĞ· OnlineSim\n"
        "â”” ğŸ¤– Ğ‘Ğ¾Ñ‚Ğ¾Ğ²Ğ¾Ğ´ â€” ÑĞ¸Ğ¼ÑƒĞ»ÑÑ†Ğ¸Ñ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ² ĞºĞ°Ğ½Ğ°Ğ»Ğ°Ñ…\n\n"
        "ğŸ“Š <b>ĞĞĞĞ›Ğ˜Ğ¢Ğ˜ĞšĞ</b>\n"
        "â”œ ğŸ‘¥ ĞÑƒĞ´Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¸ â€” Ñ‚ĞµĞ³Ğ¸, Ñ‡Ñ‘Ñ€Ğ½Ñ‹Ğ¹ ÑĞ¿Ğ¸ÑĞ¾Ğº, ÑĞºÑĞ¿Ğ¾Ñ€Ñ‚\n"
        "â”œ ğŸ“„ Ğ¨Ğ°Ğ±Ğ»Ğ¾Ğ½Ñ‹ â€” Ğ·Ğ°Ğ³Ğ¾Ñ‚Ğ¾Ğ²ĞºĞ¸ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹\n"
        "â”” ğŸ“ˆ ĞĞ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ° â€” heatmap, Ñ€Ğ¸ÑĞºĞ¸, ÑĞµĞ³Ğ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ\n"
        "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n"
        "<b>âš¡ ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹:</b>\n"
        "/menu â€” Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ Ğ¼ĞµĞ½Ñ\n"
        "/stats â€” Ğ±Ñ‹ÑÑ‚Ñ€Ğ°Ñ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°\n"
        "/panic â€” ÑĞºÑÑ‚Ñ€ĞµĞ½Ğ½Ğ°Ñ Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ğ²ÑĞµÑ… Ğ·Ğ°Ğ´Ğ°Ñ‡\n"
        "/resume â€” Ğ²Ğ¾Ğ·Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾ÑĞ»Ğµ Ğ¿Ğ°Ğ½Ğ¸ĞºĞ¸\n"
        "/help â€” ÑĞ¿Ñ€Ğ°Ğ²ĞºĞ° Ğ¿Ğ¾ Ñ€Ğ°Ğ·Ğ´ĞµĞ»Ğ°Ğ¼\n\n"
        "ğŸ‘‡ <b>Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ñ€Ğ°Ğ·Ğ´ĞµĞ» Ğ´Ğ»Ñ Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹:</b>",
        kb_main_menu()
    )

def handle_cancel(chat_id: int, user_id: int):
    """Handle cancel button"""
    show_main_menu(chat_id, user_id, "âŒ Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ Ğ¾Ñ‚Ğ¼ĞµĞ½ĞµĞ½Ğ¾\nğŸ“‹ <b>Ğ“Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ Ğ¼ĞµĞ½Ñ</b>")

def handle_panic_stop(chat_id: int, user_id: int):
    """Handle /panic command - emergency stop"""
    # ĞŸÑ€Ğ¸Ğ¾ÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµĞ¼ Ğ²ÑĞµ ĞºĞ°Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ğ¸
    DB.pause_all_campaigns(user_id, reason='Panic stop')
    # ĞŸÑ€Ğ¸Ğ¾ÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµĞ¼ Ğ²ÑĞµ Ğ·Ğ°Ğ´Ğ°Ğ½Ğ¸Ñ Ğ±Ğ¾Ñ‚Ğ¾Ğ²Ğ¾Ğ´Ğ°
    assignments = DB.get_herder_assignments(user_id, status='active')
    for a in assignments:
        DB.pause_herder_assignment(a['id'])
    # Ğ£ÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµĞ¼ Ñ„Ğ»Ğ°Ğ³ Ğ¿Ğ°ÑƒĞ·Ñ‹
    DB.set_panic_stop(user_id, reason='Manual panic stop via /panic')
    send_message(chat_id,
        "ğŸš¨ <b>Ğ­ĞšĞ¡Ğ¢Ğ Ğ•ĞĞĞĞ¯ ĞĞ¡Ğ¢ĞĞĞĞ’ĞšĞ ĞĞšĞ¢Ğ˜Ğ’Ğ˜Ğ ĞĞ’ĞĞĞ</b>\n"
        "âœ… Ğ’ÑĞµ Ñ€Ğ°ÑÑÑ‹Ğ»ĞºĞ¸ Ğ¿Ñ€Ğ¸Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ñ‹\n"
        "âœ… Ğ’ÑĞµ Ğ·Ğ°Ğ´Ğ°Ğ½Ğ¸Ñ Ğ±Ğ¾Ñ‚Ğ¾Ğ²Ğ¾Ğ´Ğ° Ğ¿Ñ€Ğ¸Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ñ‹\n"
        "âœ… Ğ’ÑĞµ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸ Ğ¿Ğ°Ñ€ÑĞ¸Ğ½Ğ³Ğ° Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ñ‹\n"
        "âœ… Ğ’Ğ¾Ñ€ĞºĞµÑ€Ñ‹ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ğ»Ğ¸ ÑĞ¸Ğ³Ğ½Ğ°Ğ» Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ¸\n"
        "Ğ”Ğ»Ñ Ğ²Ğ¾Ğ·Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ /resume",
        kb_main_menu()
    )

def handle_resume(chat_id: int, user_id: int):
    """Handle /resume command - resume after panic stop"""
    if not DB.is_system_paused(user_id):
        send_message(chat_id,
            "â„¹ï¸ Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ½Ğµ Ğ±Ñ‹Ğ»Ğ° Ğ¿Ñ€Ğ¸Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ°.",
            kb_main_menu()
        )
        return
    DB.clear_panic_stop(user_id)
    send_message(chat_id,
        "âœ… <b>Ğ Ğ°Ğ±Ğ¾Ñ‚Ğ° Ğ²Ğ¾Ğ·Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ°</b>\n"
        "Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° ÑĞ½Ğ¾Ğ²Ğ° Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ°.\n"
        "ĞŸÑ€Ğ¸Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ‹Ğµ Ñ€Ğ°ÑÑÑ‹Ğ»ĞºĞ¸ Ğ¸ Ğ·Ğ°Ğ´Ğ°Ğ½Ğ¸Ñ Ğ±Ğ¾Ñ‚Ğ¾Ğ²Ğ¾Ğ´Ğ°\n"
        "Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ²Ğ¾Ğ·Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ Ğ² ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ñ… Ñ€Ğ°Ğ·Ğ´ĞµĞ»Ğ°Ñ….",
        kb_main_menu()
    )

def handle_back(chat_id: int, user_id: int, saved: dict):
    """Handle back button - return to previous state"""
    prev_state = saved.get('prev_state', '')
    if prev_state:
        DB.set_user_state(user_id, prev_state, saved.get('prev_data', {}))
        return prev_state
    else:
        show_main_menu(chat_id, user_id)
        return None

def handle_help(chat_id: int, user_id: int):
    """Handle /help command"""
    send_message(chat_id,
        "ğŸ“š <b>Ğ¡Ğ¿Ñ€Ğ°Ğ²ĞºĞ° Ğ¿Ğ¾ Ğ±Ğ¾Ñ‚Ñƒ</b>\n\n"
        "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n"
        "<b>âš¡ ĞšĞĞœĞĞĞ”Ğ«</b>\n"
        "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n"
        "/start â€” Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ Ğ¸ Ğ¾Ğ±Ğ·Ğ¾Ñ€ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚ĞµĞ¹\n"
        "/menu â€” Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ Ğ¼ĞµĞ½Ñ\n"
        "/stats â€” Ğ±Ñ‹ÑÑ‚Ñ€Ğ°Ñ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°\n"
        "/panic â€” <b>Ğ­ĞšĞ¡Ğ¢Ğ Ğ•ĞĞĞĞ¯ ĞĞ¡Ğ¢ĞĞĞĞ’ĞšĞ</b> Ğ²ÑĞµÑ… Ğ·Ğ°Ğ´Ğ°Ñ‡\n"
        "/resume â€” Ğ²Ğ¾Ğ·Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñƒ Ğ¿Ğ¾ÑĞ»Ğµ Ğ¿Ğ°Ğ½Ğ¸ĞºĞ¸\n"
        "/help â€” ÑÑ‚Ğ° ÑĞ¿Ñ€Ğ°Ğ²ĞºĞ°\n\n"
        "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n"
        "<b>ğŸ“¥ Ğ˜Ğ¡Ğ¥ĞĞ”Ğ¯Ğ©Ğ˜Ğ• Ğ”Ğ•Ğ™Ğ¡Ğ¢Ğ’Ğ˜Ğ¯</b>\n"
        "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n"
        "ğŸ” <b>ĞŸĞ°Ñ€ÑĞ¸Ğ½Ğ³</b>\n"
        "   Ğ¡Ğ±Ğ¾Ñ€ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹ Ğ¸Ğ· Ñ‡Ğ°Ñ‚Ğ¾Ğ² Ğ¸ ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸ĞµĞ².\n"
        "   ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ° Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ğ¾ ĞºĞ»ÑÑ‡ĞµĞ²Ñ‹Ğ¼ ÑĞ»Ğ¾Ğ²Ğ°Ğ¼.\n\n"
        "ğŸ“¤ <b>Ğ Ğ°ÑÑÑ‹Ğ»ĞºĞ°</b>\n"
        "   ĞœĞ°ÑÑĞ¾Ğ²Ğ°Ñ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° Ğ¿Ğ¾ ÑĞ¿Ğ°Ñ€ÑĞµĞ½Ğ½Ğ¾Ğ¹ Ğ°ÑƒĞ´Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¸.\n"
        "   Ğ£Ğ¼Ğ½Ñ‹Ğµ Ğ·Ğ°Ğ´ĞµÑ€Ğ¶ĞºĞ¸, Ñ€Ğ¾Ñ‚Ğ°Ñ†Ğ¸Ñ Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚Ğ¾Ğ².\n\n"
        "ğŸ“ <b>ĞšĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚</b>\n"
        "   Ğ˜Ğ˜-Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾ÑÑ‚Ğ¾Ğ² Ñ‡ĞµÑ€ĞµĞ· Yandex GPT.\n"
        "   ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ñ‚Ñ€ĞµĞ½Ğ´Ğ¾Ğ², Ğ¸Ñ‚Ğ¾Ğ³Ğ¸ Ğ¾Ğ±ÑÑƒĞ¶Ğ´ĞµĞ½Ğ¸Ğ¹.\n\n"
        "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n"
        "<b>ğŸ¤– Ğ£ĞŸĞ ĞĞ’Ğ›Ğ•ĞĞ˜Ğ• ĞĞšĞšĞĞ£ĞĞ¢ĞĞœĞ˜</b>\n"
        "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n"
        "ğŸ‘¤ <b>ĞĞºĞºĞ°ÑƒĞ½Ñ‚Ñ‹</b>\n"
        "   Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ, Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ñ‹, Ğ½Ğ°Ğ´Ñ‘Ğ¶Ğ½Ğ¾ÑÑ‚ÑŒ, Ğ¿Ğ°Ğ¿ĞºĞ¸.\n\n"
        "ğŸ­ <b>Ğ¤Ğ°Ğ±Ñ€Ğ¸ĞºĞ°</b>\n"
        "   ĞĞ²Ñ‚Ğ¾-ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ñ‡ĞµÑ€ĞµĞ· OnlineSim.\n"
        "   ĞŸÑ€Ğ¾Ğ³Ñ€ĞµĞ² Ğ½Ğ¾Ğ²Ñ‹Ñ… Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚Ğ¾Ğ² 3-14 Ğ´Ğ½ĞµĞ¹.\n\n"
        "ğŸ¤– <b>Ğ‘Ğ¾Ñ‚Ğ¾Ğ²Ğ¾Ğ´</b>\n"
        "   Ğ¡Ğ¸Ğ¼ÑƒĞ»ÑÑ†Ğ¸Ñ Ğ¶Ğ¸Ğ²Ğ¾Ğ¹ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ² ĞºĞ°Ğ½Ğ°Ğ»Ğ°Ñ….\n"
        "   Ğ¡Ñ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ğ¸: ĞĞ°Ğ±Ğ»ÑĞ´Ğ°Ñ‚ĞµĞ»ÑŒ, Ğ­ĞºÑĞ¿ĞµÑ€Ñ‚, ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ°.\n\n"
        "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n"
        "<b>ğŸ“Š ĞĞĞĞ›Ğ˜Ğ¢Ğ˜ĞšĞ Ğ˜ Ğ”ĞĞĞĞ«Ğ•</b>\n"
        "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n"
        "ğŸ‘¥ <b>ĞÑƒĞ´Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¸</b> â€” Ñ‚ĞµĞ³Ğ¸, Ñ‡Ñ‘Ñ€Ğ½Ñ‹Ğ¹ ÑĞ¿Ğ¸ÑĞ¾Ğº, ÑĞºÑĞ¿Ğ¾Ñ€Ñ‚\n"
        "ğŸ“„ <b>Ğ¨Ğ°Ğ±Ğ»Ğ¾Ğ½Ñ‹</b> â€” Ñ‚ĞµĞºÑÑ‚Ğ¾Ğ²Ñ‹Ğµ Ğ¸ Ğ¼ĞµĞ´Ğ¸Ğ°-ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ\n"
        "ğŸ“ˆ <b>ĞĞ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ°</b> â€” heatmap, Ñ€Ğ¸ÑĞºĞ¸, ÑĞµĞ³Ğ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ\n\n"
        "âš™ï¸ <b>ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸</b> â€” Ğ·Ğ°Ğ´ĞµÑ€Ğ¶ĞºĞ¸, API, Ğ¿Ğ¾Ğ²ĞµĞ´ĞµĞ½Ğ¸Ğµ",
        kb_main_menu()
    )

def show_quick_stats(chat_id: int, user_id: int):
    """Show quick dashboard stats"""
    stats = DB.get_dashboard_stats(user_id)
    msg = (
        "ğŸ“Š <b>Ğ‘Ñ‹ÑÑ‚Ñ€Ğ°Ñ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°</b>\n"
        f"ğŸ‘¥ ĞÑƒĞ´Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¹: <b>{stats['audiences']}</b> ({stats['audiences_completed']} Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ñ‹)\n"
        f"ğŸ“„ Ğ¨Ğ°Ğ±Ğ»Ğ¾Ğ½Ğ¾Ğ²: <b>{stats['templates']}</b>\n"
        f"ğŸ‘¤ ĞĞºĞºĞ°ÑƒĞ½Ñ‚Ğ¾Ğ²: <b>{stats['accounts']}</b> ({stats['accounts_active']} Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹)\n"
        f"ğŸ“¤ ĞšĞ°Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ğ¹: <b>{stats['campaigns']}</b>\n"
        f"ğŸ“ˆ ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¾: <b>{stats['total_sent']}</b>\n"
        f"âœ… Ğ£ÑĞ¿ĞµÑˆĞ½Ğ¾ÑÑ‚ÑŒ: <b>{stats['success_rate']}%</b>\n"
        f"ğŸ¤– <b>Ğ‘Ğ¾Ñ‚Ğ¾Ğ²Ğ¾Ğ´:</b>\n"
        f"   ĞĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… Ğ·Ğ°Ğ´Ğ°Ğ½Ğ¸Ğ¹: {stats.get('herder_active_assignments', 0)}\n"
        f"   ĞšĞ°Ğ½Ğ°Ğ»Ğ¾Ğ²: {stats.get('monitored_channels', 0)}\n"
        f"   Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğ¹: {stats.get('herder_actions', 0)}\n"
        f"ğŸ­ <b>ĞŸÑ€Ğ¾Ğ³Ñ€ĞµĞ²:</b>\n"
        f"   Ğ’ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞµ: {stats.get('warmup_in_progress', 0)}\n"
        f"   Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ñ‹: {stats.get('warmup_completed', 0)}\n"
    )
    if stats.get('high_risk_accounts', 0) > 0:
        msg += f"âš ï¸ <b>Ğ’Ğ½Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ğµ:</b> {stats['high_risk_accounts']} Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚Ğ¾Ğ² Ñ Ğ²Ñ‹ÑĞ¾ĞºĞ¸Ğ¼ Ñ€Ğ¸ÑĞºĞ¾Ğ¼!"
    send_message(chat_id, msg, kb_main_menu())
